"0",""
"0","dir.create(file.path(""../output/plots/forest/continuous/""))"
"0","dir.create(file.path(""../output/plots/forest/dichotomous/""))"
"0",""
"0","forest.mean <- function(x) {"
"0","  xlsx_path <- paste0(""../input/data/xlsx/continuous/"",x,"".xlsx"")"
"0","  csv_path <- paste0(""../input/data/csv/continuous/"",x,"".csv"")"
"0","  svg_path <- paste0(""../output/plots/forest/continuous/svg/"",x,"".svg"")"
"0","  "
"0","  data <- read_excel(xlsx_path) %>%"
"0","    rename(ni = paste0(x, ""_n""), mi = paste0(x, ""_mean""), sdi = paste0(x, ""_sd"")) %>% "
"0","    select(study, graft_type, ni, mi, sdi)"
"0","  data <- escalc(measure = ""MN"", ni = ni, mi = mi, sdi = sdi, data = data, slab = study)"
"0","  res <- rma(yi, vi, data = data, slab = study)"
"0","  data <- summary(data)"
"0","  "
"0","  write.csv(data, file = csv_path, row.names = FALSE)"
"0","  "
"0","  alim <- c(min(data$ci.lb), max(data$ci.ub))"
"0","  alim[1] <- ifelse(alim[1] > 10, floor(alim[1]/5)*5, floor(alim[1]/0.5)*0.5)"
"0","  alim[2] <- ifelse(alim[2] > 20, ceiling(alim[2]/5)*5, ceiling(alim[2]/0.5)*0.5)"
"0","  "
"0","  xlim <- c(alim[1]-1.65*diff(alim),alim[1]+1.65*diff(alim))"
"0","  "
"0","  ilab <- function(arg) {"
"0","    (3.3*diff(alim)*arg) + xlim[1]"
"0","  }"
"0","  ilab.xpos <- ilab(c(0.33,0.39,0.45))"
"0","  height = (res$k + 13)/4"
"0","  ks <- sum(data$graft_type == ""S-QT"")"
"0","  kb <- sum(data$graft_type == ""B-QT"")"
"0","  k <- ks + kb"
"0","  scale_efac <- function(k) {"
"0","    if (k < 7) {"
"0","      return(c(1.0, 0.8, 0.6))"
"0","    } else if (k <= 20) {"
"0","      return(c(0.8, 0.6, 0.4))"
"0","    } else if (k > 21) {"
"0","      return(c(0.3, 0.3, 0.2))"
"0","    } else {"
"0","      return(c(0.3, 0.3, 0.2))"
"0","    }}"
"0","  efac_value <- scale_efac(k)"
"0","  "
"0","  "
"0","  m.mean <- metamean(ni, mi, sdi, study, data, sm = ""MRAW"", subgroup = graft_type,"
"0","                     fixed = FALSE, random = TRUE, method.tau = ""REML"", tau.common = ifelse(k<10,TRUE,FALSE), "
"0","                     hakn = TRUE, method.random.ci = ""HK"")"
"0","  "
"0","  range <- (alim[2] - alim[1]) * 1.65"
"0","  "
"0","  ks <- sum(data$graft_type == ""S-QT"")"
"0","  kb <- sum(data$graft_type == ""B-QT"")"
"0","  k <- ks + kb"
"0","  ylim <- c(-3,k+9)"
"0","  "
"0","  m.mean <- metamean(n = ni, mean = mi, sd = sdi, studlab = study, data = data,"
"0","                     sm = ""MRAW"", fixed = FALSE, random = TRUE, tau.common = FALSE,"
"0","                     method.tau = ""REML"", method.random.ci = ""HK"", subgroup = graft_type)"
"0","  summary(m.mean)"
"0","  "
"0","  res.sqt <- rma(yi, vi, data = data, subset = graft_type == ""S-QT"")"
"0","  res.bqt <- rma(yi, vi, data = data, subset = graft_type == ""B-QT"")"
"0","  reg <- rma(yi, vi, data = data, mods = ~ graft_type)"
"0","  # res.mv <- rma.mv(yi, vi, data = data, slab = study, mods = ~ graft_type, method = ""REML"")"
"0","  # pred.mv <- predict(res.mv, digits =2)"
"0","  # data$graft_type <- relevel(factor(data$graft_type), ref = ""S-QT"")"
"0","  "
"0","  # Generate and save forest plot"
"0","  "
"0","  height = (res$k + 13)/4"
"0","  svg(file = svg_path, width = 9, height = height)"
"0","  op <- par(xpd=TRUE)"
"0","  "
"0","  mlabfun <- function(text, x) {"
"0","    list(bquote(paste(.(text), "
"0","                      italic(""\u03c4""^2), "" = "", .(fmtx(x$tau2, digits=2)) , "", "","
"0","                      italic(I)^2, "" = "", .(fmtx(x$I2, digits=1)), ""%, "", "
"0","                      italic(p),.(fmtp(x$QEp, digits=3, add0=TRUE, sep=TRUE, equal=TRUE))"
"0","    )))"
"0","  }"
"0","  "
"0","  with("
"0","    res,"
"0","    forest("
"0","      res,"
"0","      cex = 0.85,"
"0","      top = 2,"
"0","      alim = alim, "
"0","      xlim = xlim,"
"0","      ylim = c(-3,k+9),"
"0","      ilab = cbind("
"0","        ni,"
"0","        formatC(mi, format = ""f"", digits = 2),"
"0","        formatC(sdi, format = ""f"", digits = 2)"
"0","      ),"
"0","      ilab.xpos = ilab.xpos,"
"0","      ilab.pos = 2,"
"0","      rows = c(3:(kb + 2), (kb + 7):(k + 6)),"
"0","      refline = coef(res),"
"0","      mlab = mlabfun(""RE Model for All Studies: "", res),"
"0","      plim = c(0.8, 1.2, 0.85),"
"0","      fonts = ""Calibri Light"","
"0","      header = ""Author(s) and Year"","
"0","      efac = efac_value,"
"0","      shade = ""zebra"","
"0","      xlab = """","
"0","      addpred=TRUE"
"0","    )"
"0","  )"
"0","  "
"0","  # Add additional column header labels"
"0","  text(ilab.xpos, k+9, c(""N"", ""Mean"", ""SD""), pos=2, cex =0.85, font=2)"
"0","  "
"0","  # Add subgroup title labels"
"0","  text(xlim[1], c(k + 7.1, kb + 3.1), pos=4, c(""S-QT"",""B-QT""), cex = 0.85, font =2)"
"0","  "
"0","  addpoly(res.sqt, "
"0","          row=kb+5.5, "
"0","          mlab=mlabfun(""RE Model for Subgroup: "", res.sqt), cex=0.85, addpred=TRUE, efac=efac_value)"
"0","  "
"0","  addpoly(res.bqt, "
"0","          row= 1.5, "
"0","          mlab=mlabfun(""RE Model for Subgroup: "", res.bqt), cex=0.85, addpred=TRUE, efac=efac_value)"
"0","  "
"0","  text(xlim[1], -2.2, pos=4, cex=0.85, bquote(paste(""Test for Subgroup Differences: "","
"0","                                                    italic(Q)[M], "" = "", .(fmtx(reg$QM, digits=2)),"
"0","                                                    "", df = "", .(reg$p - 1), "", "","
"0","                                                    italic(p),.(fmtp(reg$QMp, digits=3, add0=TRUE, sep=TRUE, equal=TRUE)))))"
"0","  "
"0","  par(op)"
"0","  dev.off()"
"0","}"
"0",""
"0","forest.prop <- function(x) {"
"0","  # Define file paths"
"0","  xlsx_path <- paste0(""../input/data/xlsx/dichotomous/"",x,"".xlsx"")"
"0","  csv_path <- paste0(""../input/data/csv/dichotomous/"",x,"".csv"")"
"0","  svg_path <- paste0(""../output/plots/forest/dichotomous/svg/"",x,"".svg"")"
"0","  "
"0","  data <- read_excel(xlsx_path) %>%"
"0","    rename(ni = paste0(x, ""_n""), xi = paste0(x, ""_event"")) %>% "
"0","    select(study, graft_type, ni, xi)"
"0","  "
"0","  data <- escalc(measure = ""PLO"", ni = ni, xi = xi, data = data, slab = study)"
"0","  data <- summary(data,transf=transf.ilogit)"
"0","  # data.back <- summary(data, transf=transf.ilogit)"
"0","  # data$ilogit.yi <- data.back$yi"
"0","  # data$ilogit.ci.lb <- data.back$ci.lb"
"0","  # data$ilogit.ci.ub <- data.back$ci.ub"
"0","  write.csv(data, file = csv_path, row.names = FALSE)"
"0","  "
"0","  View(data)"
"0","  "
"0","  alim <- c(min(data$ci.lb), max(data$ci.ub))"
"0","  alim[1] <- ifelse(alim[1] > 10, floor(alim[1]/5)*5, floor(alim[1]/0.5)*0.5)"
"0","  alim[2] <- round(max(data$ci.ub[data$ci.ub != max(data$ci.ub)]), 2)"
"0","  #alim[2] <- ifelse(alim[2] > 20, ceiling(alim[2]/5)*5, ceiling(alim[2]/0.5)*0.5)"
"0","  xlim <- c(alim[1]-1.65*diff(alim),alim[1]+1.65*diff(alim))"
"0","  "
"0","  ilab <- function(arg) {"
"0","    (3.3*diff(alim)*arg) + xlim[1]"
"0","  }"
"0","  ilab.xpos <- ilab(c(0.39,0.45))"
"0","  "
"0","  "
"0","  ks <- sum(data$graft_type == ""S-QT"")"
"0","  kb <- sum(data$graft_type == ""B-QT"")"
"0","  k <- ks + kb"
"0","  y <- c(-3,k+9)"
"0","  "
"0","  "
"0","  "
"0","  m.prop <- metaprop(event = xi, "
"0","                     n = ni, "
"0","                     studlab = study, "
"0","                     data = data, "
"0","                     method = ""GLMM"", "
"0","                     sm = ""PLOGIT"", "
"0","                     fixed = FALSE, "
"0","                     random = TRUE, "
"0","                     method.random.ci = ""HK"", "
"0","                     tau.common = TRUE)"
"0","  "
"0","  res.glmm <- rma.glmm(measure = ""PLO"", ni = ni, xi = xi, data = data, slab = study)"
"0","  pred <- predict(res.glmm, transf = transf.ilogit, digits = 2)"
"0","  "
"0","  # Generate and save forest plot"
"0","  scale_efac <- function(k) {"
"0","    if (k < 7) {"
"0","      return(c(1.0, 0.8, 0.6))"
"0","    } else if (k <= 15) {"
"0","      return(c(0.8, 0.6, 0.4))"
"0","    } else {"
"0","      return(c(0.4, 0.3, 0.2))"
"0","    }}"
"0","  efac_value <- scale_efac(k)"
"0","  "
"0","  height = (res.glmm$k + 13)/4"
"0","  svg(file = svg_path, width = 9, height = height)"
"0","  op <- par(xpd=TRUE)"
"0","  "
"0","  with(data, {"
"0","    forest(yi, ci.lb = ci.lb, ci.ub = ci.ub, slab = study,"
"0","           cex = 0.85, top = 2, alim = alim, at = seq(alim[1], alim[2], 0.1),"
"0","           xlim = xlim, ylim = c(-3,k+9),"
"0","           ilab = cbind(ni, xi), ilab.xpos = ilab.xpos,"
"0","           ilab.pos = 2, rows = c(3:(kb + 2), (kb + 7):(k + 6)),"
"0","           refline = pred$pred, mlab = ""RE Model for All Studies: "","
"0","           plim = c(0.9, 1.2, 0.85), fonts = ""Calibri Light"","
"0","           header = FALSE,"
"0","           #header = ""Author(s) and Year"", "
"0","           efac = efac_value, "
"0","           shade = ""zebra"","
"0","           xlab = """", digits = 3L"
"0","    )"
"0","  })"
"0","  "
"0","  "
"0","  # Add additional column header labels"
"0","  text(ilab.xpos, k+9, c(""N"", ""Event""), pos = 2, cex = 0.85, font = 2)"
"0","  "
"0","  View(m.prop)"
"0","  View(res.glmm)"
"0","  "
"0","  # Add subgroup title labels"
"0","  text(xlim[1], c(k+7.1, kb+3.1), pos = 4, c(""S-QT"", ""B-QT""), cex = 0.85, font = 2)"
"0","  "
"0","  # Add summary statistics, polygon, and pooled estimate for subgroup A"
"0","  m.prop.sqt <- update(m.prop, subset = graft_type == ""S-QT"")"
"0","  res.sqt <- update(res.glmm, subset = graft_type == ""S-QT"")"
"0","  pred.sqt <- predict(res.sqt, transf = transf.ilogit, digits = 2)"
"0","  "
"0","  text(xlim[1], kb + 5.5, pos = 4, cex = 0.85, bquote(paste("
"0","    ""RE Model for Subgroup: "", italic(""\u03c4""^2), "" = "", .(fmtx(m.prop.sqt$tau2, digits = 2)), "", "","
"0","    italic(I)^2, "" = "", .(fmtx(m.prop.sqt$I2 * 100, digits = 1)), ""%, "", "
"0","    italic(p), .(fmtp(m.prop.sqt$pval.Q[1], digits = 3, add0 = TRUE, sep = TRUE, equal = TRUE))"
"0","  )))"
"0","  addpoly(pred.sqt$pred, ci.lb = pred.sqt$ci.lb, ci.ub = pred.sqt$ci.ub, row = kb + 5.5, efac = 0.3)"
"0","  "
"0","  "
"0","  # Add summary statistics, polygon, and pooled estimate for subgroup B"
"0","  m.prop.bqt <- update(m.prop, subset = graft_type == ""B-QT"")"
"0","  res.bqt <- update(res.glmm, subset = graft_type == ""B-QT"")"
"0","  pred.bqt <- predict(res.bqt, transf = transf.ilogit, digits = 2)"
"0","  "
"0","  text(xlim[1], 1.5, pos = 4, cex = 0.85, bquote(paste("
"0","    ""RE Model for Subgroup: "", italic(""\u03c4""^2), "" = "", .(fmtx(m.prop.bqt$tau2, digits = 2)), "", "","
"0","    italic(I)^2, "" = "", .(fmtx(m.prop.bqt$I2 * 100, digits = 1)), ""%, "", "
"0","    italic(p), .(fmtp(m.prop.bqt$pval.Q[1], digits = 3, add0 = TRUE, sep = TRUE, equal = TRUE))"
"0","  )))"
"0","  addpoly(pred.bqt$pred, ci.lb = pred.bqt$ci.lb, ci.ub = pred.bqt$ci.ub, row = 1.5, efac = 0.3)"
"0","  "
"0","  abline(h = 0)"
"0","  "
"0","  # Add summary statistics, polygon, and pooled estimate for all studies`"
"0","  text(xlim[1], -1, pos = 4, cex = 0.85, bquote(paste("
"0","    ""RE Model for All Studies: "", italic(""\u03c4""^2), "" = "", .(fmtx(m.prop$tau2, digits = 2)), "", "","
"0","    italic(I)^2, "" = "", .(fmtx(m.prop$I2 * 100, digits = 1)), ""%, "", "
"0","    italic(p), .(fmtp(m.prop$pval.Q[1], digits = 3, add0 = TRUE, sep = TRUE, equal = TRUE))"
"0","  )))"
"0","  addpoly(pred$pred, ci.lb = pred$ci.lb, ci.ub = pred$ci.ub, row = -1, efac = 0.3)"
"0","  "
"0","  m.prop.subgroup <- update(m.prop, subgroup = graft_type)"
"0","  text(xlim[1], -2.2, pos = 4, cex = 0.85, bquote(paste("
"0","    ""Test for Subgroup Differences: "", italic(Q)[M], "" = "", .(fmtx(m.prop.subgroup$Q.b.random, digits = 2)),"
"0","    "", df = "", .(m.prop.subgroup$df.Q.b.random), "", "", italic(p), .(fmtp(m.prop.subgroup$pval.Q.b.random, digits = 3, add0 = TRUE, sep = TRUE, equal = TRUE))"
"0","  )))"
"0","  "
"0","  par(op)"
"0","  dev.off()"
"0","}"
"0",""
"0",""
"0","# Load the functions from src directory"
"0",""
"0","#here::here(""../src/functions/customfunction01.R"")"
"0","#here::here(""../src/functions/customfunction02.R"")"
"0",""
"0","lapply(continuous, forest.mean)"
"2","Registered S3 methods overwritten by 'htmltools':
  method               from         
  print.html           tools:rstudio
  print.shiny.tag      tools:rstudio
  print.shiny.tag.list tools:rstudio
"
"2","Registered S3 method overwritten by 'rmarkdown':
  method         from
  print.paged_df     
"
"1","[[1]]
"
"1","null device "
"1","
"
"1","          1 "
"1","
"
"1","
"
"1","[[2]]
"
"1","null device "
"1","
"
"1","          1 "
"1","
"
"1","
"
"1","[[3]]
"
"1","null device "
"1","
"
"1","          1 "
"1","
"
"1","
"
"1","[[4]]
"
"1","null device "
"1","
"
"1","          1 "
"1","
"
"1","
"
"1","[[5]]
"
"1","null device "
"1","
"
"1","          1 "
"1","
"
"1","
"
"1","[[6]]
"
"1","null device "
"1","
"
"1","          1 "
"1","
"
"1","
"
"1","[[7]]
"
"1","null device "
"1","
"
"1","          1 "
"1","
"
"1","
"
"1","[[8]]
"
"1","null device "
"1","
"
"1","          1 "
"1","
"
"1","
"
"1","[[9]]
"
"1","null device "
"1","
"
"1","          1 "
"1","
"
"1","
"
"1","[[10]]
"
"1","null device "
"1","
"
"1","          1 "
"1","
"
"1","
"
"1","[[11]]
"
"1","null device "
"1","
"
"1","          1 "
"1","
"
"1","
"
"1","[[12]]
"
"1","null device "
"1","
"
"1","          1 "
"1","
"
"1","
"
"1","[[13]]
"
"1","null device "
"1","
"
"1","          1 "
"1","
"
"1","
"
"1","[[14]]
"
"1","null device "
"1","
"
"1","          1 "
"1","
"
"1","
"
"1","[[15]]
"
"1","null device "
"1","
"
"1","          1 "
"1","
"
"1","
"
"1","[[16]]
"
"1","null device "
"1","
"
"1","          1 "
"1","
"
"1","
"
"1","[[17]]
"
"1","null device "
"1","
"
"1","          1 "
"1","
"
"1","
"
"1","[[18]]
"
"1","null device "
"1","
"
"1","          1 "
"1","
"
"1","
"
"0","lapply(dichotomous, forest.prop)"
"2","Error in rma.glmm(xi = xi, ni = ni, measure = ""PLO"", data = data, slab = study,  : 
  Cannot fit ML model (set 'verbose=TRUE' to obtain further details).
"
